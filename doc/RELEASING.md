# Releasing the Pariyatti Mobile App

Submission of apps to the android and iOS app stores happens during the CI builds on master branch. It is handled by codemagic pipeline and is part of codemagic.yaml configuration.

By default the submission is for internal dev testing equivalent for both the stores. This means only the users who are part of the internal dev testers shall get the testflight update(once it is added) or internal testing build from the Google play store. Reach out to the [Project Manager/Site Reliability Engineer](https://pariyatti.app/contributors.html) with the details of which Apple AppStore/Google Play email address you would like to get added to the list.

## Android

### Android Overview

The Google Play Console offers four tracks for release management:

1. Internal Testing
1. Closed Testing
1. Open Testing
1. Production

For the Pariyatti Mobile app at this point we do not need four different channels. We are moving away from maintaining the app in four tracks to just the following tracks:

1. Internal Testing
1. Production

A simple workflow allows us to add upto 100 Internal testers for testing --> Production

Any potential volunteer who would like to participate in testing of the app before it releases in production can request to be added internal testers group.

### Android App release steps

1. Login to the CodeMagic console and check that for the targest app version containing the commits that you would like to promote, app-release.aab has been submitted to internal track.
![CodeMagic Android internal track status](img/release/android/android-1-codemagic-publish.png)

1. Head over to the Google Play console and confirm that the release is already present in internal testing
![Play console version confirmation](img/release/android/android-2-google-play-console-1-internal-testing.png)


1. Promote to create production release directly
![Play console production release](img/release/android/android-2-google-play-console-6-create-production-release.png)

1. Confirm that the release notes are appropriate and submit for review. It can take anywhere from a few hours to 1-2 days for getting the approval from Play Store and the app being published
![Play console review release notes](img/release/android/android-2-google-play-console-7-production-release-notes.png)

1. You can check the status of your submission in the Production menu tab
![Play console follow status of release](img/release/android/android-2-google-play-console-8-release-review.png)

## iOS

In iOS App Store Connect we have fewer tracks to manage. There are two at this point:

### iOS Overview

1. TestFlight
1. Production Release

TestFlight requires special user invitation and the invited users need to install the TestFlight app on their iOS devices to get the version in TestFlight.

### iOS App release steps

1. Login to Apple Developer Console, and launch App Store Connnect.

1. TestFlight Release: Select the target version that is slated for a release and associate it with the internal group "Pariyatti Staff and Volunteers". Based on the changes, inform the internal communication thread that build is available to test.

![App Store Connect Release TestFlight](img/release/ios/ios-1-appstore-connect-1-testflight.png)

1. In case there is a need to modify the Group member list, head to the group in "Internal Testing". This shows the list of current members and the versions their TestFlight apps are running.

![App Store Connect TestFlight Groups](img/release/ios/ios-1-appstore-connect-2-grouplist.png)

1. Production Release: Head to "App Store" tab in App Store Connect and click on the +(plus) icon besides the iOS app and enter the target semver of the app that was generated by CI as seen previously

![App Store Connect New Production Release](img/release/ios/ios-1-appstore-connect-3-new-release.png)

1. Add the release notes, these would highly be probably same accross both Android and iOS apps, unless we are addressing a platform specific issue.

![App Store Connect Production Release Notes](img/release/ios/ios-1-appstore-connect-4-whats-new.png)

1. Select the target version in the "Build Section"

![App Store Connect Production Release Select Version](img/release/ios/ios-1-appstore-connect-5-select-build.png)

![App Store Connect Production Release Select Build](img/release/ios/ios-1-appstore-connect-6-add-build.png)

1. Select automatic release and release to all the users. We are defaulting to the simplest release process.

![App Store Connect Production Release Automatic](img/release/ios/ios-1-appstore-connect-7-automatic-release.png)

1. Check the release information once and add it to queue using "Add for Review" button

![App Store Connect Production Add to Review Queue](img/release/ios/ios-1-appstore-connect-8-add-for-review.png)

1. Confirm submission and "Submit to App Review"

![App Store Connect Production Submit Review](img/release/ios/ios-1-appstore-connect-9-confirm-submission.png)

Both the app release processes take a few hours typically to be approved and emails are sent to us once the app has been made live. So, watch out for those. Thank you!
